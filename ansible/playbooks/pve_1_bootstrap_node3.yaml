# This to be run as root
# FIRST TIME ONLY use -k for input password and install sshpass "brew install hudochenkov/sshpass/sshpass"

- name: Bootstrap PVE servers
  hosts: pve_node3
  vars:
    ssh_pub_key_path: "~/.ssh/id_rsa.pub"
    zfs_pools:
      - name: "tank"
        disks:
          - "/dev/sdb"
        dataset_name: "images"
        storage:
          name: "vmimages"
          content: "images,rootdir"
      - name: "kube-pool"
        disks:
          - "/dev/nvme1n1"
        dataset_name: "kube-data"
        storage:
          name: "kubedata"
          content: "images,rootdir"

    storage_config_file_template: "pve_storage_config_node3"
    cpu_vendor: "amd"
    gpu_ids: "10de:2504,10de:228e"
    nfs_mounts:
      truenas-backup-vms:
        export: /mnt/backup-pool-1/proxmox-vms
        path: /mnt/pve/truenas-backup-vms
        server: "192.168.100.60"
        content: "iso,backup,images"
  roles:
#    - pve_bootstrap_user
#    - pve_manage_repositories
#    - update_host
    - pve_create_storage
#    - pve_gpu_passthrough
#    - prometheus.prometheus.node_exporter
